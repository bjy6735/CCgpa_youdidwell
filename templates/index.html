<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ì  ê³„ì‚°ê¸°</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Jua", serif;
        }
        h1 {
            font-weight: 700;
            color: #ff623f;
        }
        label, button {
            font-weight: 400;
        }
    </style>
</head>

<body>
    <div align=center>
    <h1>ğŸ”¥í•™ì  ê³„ì‚°ê¸°ğŸ”¥</h1>

    <!-- ê³¼ëª© ê°œìˆ˜ ì…ë ¥ -->
    <div id="step-1">
        <p><label>ë§Œë‚˜ì„œ ë°˜ê°€ì›Œìš”!</label></p>
        <p><label>ğŸ±ê³¼ëª©ìˆ˜, ì„±ì , ì´ìˆ˜ì‹œê°„ì„ ì…ë ¥í•˜ë©´ ì„±ì ì„ ì•Œë ¤ì¤„ê²Œìš”ğŸ±</label></p>
        <p>ğŸ€â˜˜ï¸ğŸ€</p>
        <p><label>ëª‡ê³¼ëª©ì˜ ì„±ì ì„ ê³„ì‚°í•´ë³¼ê¹Œìš”?:</label></p>
        <input type="number" id="num-subjects" min="1" required>
        <button onclick="generateGradeFields()">âœ…</button>
    </div>

    <!-- ì„±ì  ì…ë ¥ -->
    <div id="step-2" style="display: none;">
        <form id="grade-form">
            <div id="grade-fields"></div>
            <button type="button" onclick="submitGrades()">ğŸ í•™ì  ê³„ì‚°í•˜ê¸°ğŸ¡</button>
        </form>
    </div>

    <!-- ê²°ê³¼ ì¶œë ¥ -->
    <div id="step-3" style="display: none;">
        <h2>ğŸˆ: ìˆ˜ê³ í–ˆì•¼ì˜¹</h2>
        <p>í‰ê· í•™ì â¡ï¸ <span id="gpa"></span></p>
        <img id="chart" alt="ì„±ì  ë¹„ìœ¨ ê·¸ë˜í”„">
        
        <!-- ë§Œì¡±ë„ -->
        <label for="satisfaction-select" style="display: block; margin-top: 10px;">ì„±ì ì— ë§Œì¡±í•˜ì‹œë‚˜ìš”?</label>
        <select name="satisfaction" id="satisfaction-select" multiple>
            <option value="ë§Œì¡±!/yes">ë§Œì¡±!/yes</option>
            <option value="ì¡°ê¸ˆì€ìš”/a_little_bit">ì¡°ê¸ˆì€ìš”/a_little_bit</option>
            <option value="ëª¨ë¥´ê² ì–´ìš”/i'm_not_sure">ëª¨ë¥´ê² ì–´ìš”/i'm_not_sure</option>
            <option value="ë”±íˆìš”/not_exactly">ë”±íˆìš”/not_exactly</option>
            <option value="ì•„ë‹ˆìš”/no">ì•„ë‹ˆìš”/no</option>
            <option value="ìŠ¬í¼ìš”/i'm_sad">ìŠ¬í¼ìš”/i'm_sad</option>
        </select>

        <!-- ì´ë¦„ -->
        <p><label>ê·¼ë° í˜¹ì‹œ.. ì´ë¦„ì´ ë­ì˜ˆìš”?ğŸ˜¼</label></p>
        <input type="text" id="myname" placeholder="ã‚ãªãŸã®åå‰ã§ã™ã€‚">

        <p><label>ë­”ê°€ ë˜ í•˜ê³ ì‹¶ì€ ë§ì´ ìˆë‚˜ìš”? ë“¤ì–´ì¤„ê²Œìš”!ğŸ˜º</label></p>
        <input type="text" id="talktome" placeholder="ì–´ëŠ ë§ì´ë“ ì§€ ì¢‹ì•„ìš”">

        <button onclick="submitSatisfaction()">talk!</button>
        <p id="chatbot-response"></p>
    </div>

    <script>
        function generateGradeFields() {
            const numSubjects = parseInt($("#num-subjects").val());
            if (isNaN(numSubjects) || numSubjects < 1) {
                alert("ì˜¬ë°”ë¥¸ ê³¼ëª© ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                return;
            }

            $("#grade-fields").empty();
            for (let i = 0; i < numSubjects; i++) {
                $("#grade-fields").append(`
                    <div>
                    <p>
                        <label>ê³¼ëª© ${i + 1} ì„±ì :</label>
                        <input type="text" name="grade_${i}" placeholder="ì˜ˆ: A+" required>
                        <label>ì´ìˆ˜ ì‹œê°„:</label>
                        <input type="number" name="credit_${i}" min="1" required>
                    </p>
                    </div>
                `);
            }

            $("#step-1").hide();
            $("#step-2").show();
        }

        function submitGrades() {
            const grades = [];
            $("#grade-form div").each(function () {
                const grade = $(this).find("input[name^='grade']").val();
                const credit = parseInt($(this).find("input[name^='credit']").val());
                grades.push([grade, credit]);
            });

            $.ajax({
                url: "/calculate",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({ grades: grades }),
                success: function (data) {
                    $("#gpa").text(data.gpa.toFixed(2));
                    $("#chart").attr("src", data.chart_path);
                }
            });

            $("#step-2").hide();
            $("#step-3").show();
        }

        function submitSatisfaction() {
            const satisfaction = $("#satisfaction-select").val();
            const myname = $("#myname").val();
            const talktome = $("#talktome").val();
            $.ajax({
                url: "/chatbot",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({ 'ì„ íƒì •ë³´': satisfaction, 'ì´ë¦„': myname, 'ë§': talktome }),
                success: function (data) {
                    $("#chatbot-response").text(data.message);
                }
            });
        }

    </script>
</body>
</html>
